<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@2.1.0/build/pure-min.css" integrity="sha384-yHIFVG6ClnONEA5yB5DJXfW2/KC173DIQrYoZMEtBvGzmf0PKiGyNEqe9N6BNDBH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@2.1.0/build/grids-responsive-min.css" />
    <link rel="stylesheet" href="/css/interview.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

    <title>Interview</title>
</head>
    
<body style = "background-color: #f4eae1; font-family: 'Poppins', sans-serif;">
    <div class="topnav" id="myTopnav">
        <a href="/html/video_interview1.html">Question 1</a>
        <a href="/html/video_interview2.html">Question 2</a>
        <a href="/html/video_interview3.html"  class = "active">Question 3</a>
        <a href="#video_submission">Video Submission</a>
        <a href="/html/Welcome.html" class = "split">Home</a>
    </div>
    
    <img class = "responsive-image" src="/img/8.png" alt="interview banner">

    <div class = "pure-g">
        <div class = "pure-u-3-4">
            <div class = "container">
                <center><video id="video" width="80%" height="auto" autoplay></video></center>
            </div>
        </div>

        <div class = "pure-u-1-4">
            <div class = "container">
                <h1><b>
                    Describe a time when you had to work as part of a team on a coding project. How did you contribute to the team's success?
                </b></h1>
                <p>Duration: 2 minutes 30 seconds</p>
                <button id="start-camera">Start Camera</button><br>
                <button id="start-record">Start Recording</button><br>
                <button id="stop-record">Stop Recording</button><br>
                <a id="download-video" download="question3">Download Video</a>
                <br>
                <button class="backbtn" type="submit" onclick="document.location='video_interview3.html'" id="back_i3">Back</button>
                <a href="#video_submission"><button class="nextbtn" type="submit" id="next_i3">Next</button></a>
                
            </div>
        </div>
    </div>

    <div class = "pure-g">
        <div class = "pure-u-1 container" id = "video_submission" >
            <center><h1 style="font-family: 'Poppins', sans-serif;">That is the end of your online interview. <br> Thank you!</h1></center>
            <center><h2 style="font-family: 'Poppins', sans-serif;">Please submit the video recording for your interview below.</h2></center>

            <form action="/action_page.php">
                <p>Question 1:</p>
                <input type="file" id="question1" name="question1">
            </form>
            <br>
            <form action="/action_page.php">
                <p>Question 2:</p>
                <input type="file" id="question2" name="question2">
            </form>
            <br>
            <form action="/action_page.php">
                <p>Question 3:</p>
                <input type="file" id="question3" name="question3">
            </form>

            <button type="submit" id="submit_video" onclick="document.location='application.html'">Submit</button>
        </div>
    </div>
    
    <script>
        let camera_button = document.querySelector("#start-camera");
        let video = document.querySelector("#video");
        let start_button = document.querySelector("#start-record");
        let stop_button = document.querySelector("#stop-record");
        let download_link = document.querySelector("#download-video");

        let camera_stream = null;
        let media_recorder = null;
        let blobs_recorded = [];

        camera_button.addEventListener('click', async function() {
            camera_stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            video.srcObject = camera_stream;
        });

        start_button.addEventListener('click', function() {
            // set MIME type of recording as video/webm
            media_recorder = new MediaRecorder(camera_stream, { mimeType: 'video/webm' });

            // event : new recorded video blob available 
            media_recorder.addEventListener('dataavailable', function(e) {
                blobs_recorded.push(e.data);
            });

            // event : recording stopped & all blobs sent
            media_recorder.addEventListener('stop', function() {
                // create local object URL from the recorded video blobs
                let video_local = URL.createObjectURL(new Blob(blobs_recorded, { type: 'video/webm' }));
                download_link.href = video_local;
            });

            // start recording with each recorded blob having 1 second video
            media_recorder.start(1000);
        });

        stop_button.addEventListener('click', function() {
            media_recorder.stop(); 
        });

        document.getElementById("submit_video").addEventListener("click", function() {
            // Set video_interview status to true
            var url = new URL("/html/application.html", window.location.href);
            url.searchParams.set("video_interview", "true");
            window.location.href = url.href;
        });
    </script>
</body>
</html>